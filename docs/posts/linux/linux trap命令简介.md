---
title: linux trap命令简介
date: 2024-01-24 19:00:01
keywords: linux,trap
tags:
  - linux
categories:
  - linux
---

在 Linux 系统中，`trap` 是一个用于在接收到特定信号时执行指定命令或脚本的 Bash 命令。它是一个非常有用的工具，尤其是在脚本编程中，用于处理意外情况或清理工作。

### 基本概念

1. **信号（Signals）**：信号是 Unix 和类 Unix 系统中进程间通信的一种方式。信号是一种小的消息，通知进程某个事件已经发生。

2. **常见信号**：例如 `SIGINT`（由 Ctrl+C 触发），`SIGTERM`（一种终止进程的请求），`SIGKILL`（强制终止进程），`SIGHUP`（挂起信号，通常用于重启进程）等。

3. **使用场景**：在编写脚本时，可能需要在脚本结束或用户中断脚本时执行某些命令，如释放资源、删除临时文件、恢复设置等。`trap` 命令用于定义在接收到特定信号时自动执行的命令或脚本。

<!-- more -->

### 使用 `trap` 的语法

基本语法如下：

```bash
trap [命令或脚本] [信号]
```

这里，“命令或脚本”是在接收到特定信号时将要执行的命令或脚本，而“信号”指的是触发这些命令的信号。

### 示例

1. **捕获 Ctrl+C（SIGINT）**：

   ```bash
   trap 'echo "Ctrl+C was pressed"' SIGINT
   ```

   当用户按下 Ctrl+C 时，脚本会输出 "Ctrl+C was pressed" 而不是直接退出。

2. **脚本退出时执行清理命令**：

   ```bash
   trap 'rm -f /tmp/tempfile; echo "Temporary files removed."' EXIT
   ```

   当脚本正常结束或被中断时，指定的清理命令将被执行。

3. **忽略挂起信号（SIGHUP）**：

   ```bash
   trap '' SIGHUP
   ```

   这会使脚本忽略挂起信号，即使用户断开了 SSH 连接或关闭了终端，脚本也会继续运行。

### 注意事项

- 使用 `trap` 时应明确知道要捕获和处理的信号类型。
- 在脚本中合理使用 `trap` 可以提高脚本的健壮性和可靠性。
- 某些信号（如 `SIGKILL` 和 `SIGSTOP`）不能被捕获、阻塞或忽略。

通过使用 `trap`，你可以控制脚本在遇到中断信号时的行为，这对于保证脚本的稳定性和预期行为非常重要。