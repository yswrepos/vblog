import{_ as n,o as t,c as e,e as l}from"./app-Du_kiChf.js";const s={},i=l('<p>路由器通过使用NAT（网络地址转换）机制来区分并正确地将入站的数据包路由到内部网络中的特定设备（如设备A或设备B）。这里涉及两个关键概念：NAT表和端口号。</p><h3 id="nat表" tabindex="-1"><a class="header-anchor" href="#nat表"><span>NAT表</span></a></h3><p>NAT表是路由器用来跟踪内部网络设备（私有IP地址）与其对应的外部通信会话的关键数据结构。当设备A和设备B向外部世界发送数据包时，路由器会在NAT表中创建条目，记录以下信息：</p><ul><li><strong>内部源IP地址</strong>：发送数据包的设备的私有IP地址。</li><li><strong>内部源端口</strong>：发送数据包使用的端口号。</li><li><strong>外部源IP地址</strong>：路由器的公共IP地址（NAT转换后的地址）。</li><li><strong>外部源端口</strong>：路由器分配给该会话的唯一端口号，用于区分不同的通信会话。</li></ul><h3 id="端口号的作用" tabindex="-1"><a class="header-anchor" href="#端口号的作用"><span>端口号的作用</span></a></h3><p>当路由器将内部IP地址转换为公共IP地址时，它会为每个会话分配一个唯一的外部端口号。这样，当从外部网络返回的数据包到达路由器时，路由器会查看该数据包的目标端口号，并通过NAT表中的映射来确定这个数据包应该被发送到内部网络中的哪个设备。</p><h3 id="数据包路由的例子" tabindex="-1"><a class="header-anchor" href="#数据包路由的例子"><span>数据包路由的例子</span></a></h3><p>假设设备A（私有IP：192.168.1.10）和设备B（私有IP：192.168.1.11）分别与互联网上的服务器建立了通信会话。设备A可能使用端口12345与外部世界通信，而设备B使用端口54321。当这些设备通过路由器发送数据包时，路由器将使用其公共IP地址（假设为198.51.100.1），但为每个会话分配不同的外部端口号（例如，设备A的会话可能使用端口10000，设备B的会话使用端口20000）。</p><ul><li><strong>入站数据包到设备A</strong>：当服务器回复设备A的请求，发送数据包到198.51.100.1:10000时，路由器检查NAT表，发现这个端口号与设备A的通信会话匹配，然后将数据包的目标IP和端口转换为192.168.1.10:12345，并转发给设备A。</li><li><strong>入站数据包到设备B</strong>：类似地，如果服务器发送数据包到198.51.100.1:20000作为回复给设备B，路由器同样查看NAT表，识别这个端口号与设备B的通信会话匹配，随后将数据包的目标IP和端口转换为192.168.1.11:54321，并转发给设备B。</li></ul><p>通过这种方式，即使所有入站数据包的目标IP地址都是路由器的公共地址，路由器也能通过端口号准确地将数据包分发到正确的内部设备。这就是NAT如何使得多个设备共享一个公共IP地址进行互联网通信的同时，还能保证数据包正确路由的基本原理。</p>',10),r=[i];function a(o,A){return t(),e("div",null,r)}const p=n(s,[["render",a],["__file","NAT基本流程简述.html.vue"]]),c=JSON.parse('{"path":"/posts/net/NAT%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B%E7%AE%80%E8%BF%B0.html","title":"NAT基本流程简述","lang":"zh-CN","frontmatter":{"title":"NAT基本流程简述","date":"2024-02-27T23:53:28.000Z","tags":["net","nat"],"categories":"net"},"headers":[{"level":3,"title":"NAT表","slug":"nat表","link":"#nat表","children":[]},{"level":3,"title":"端口号的作用","slug":"端口号的作用","link":"#端口号的作用","children":[]},{"level":3,"title":"数据包路由的例子","slug":"数据包路由的例子","link":"#数据包路由的例子","children":[]}],"git":{"updatedTime":1712251162000,"contributors":[{"name":"yushen","email":"85443289+yushenw@users.noreply.github.com","commits":1}]},"filePathRelative":"posts/net/NAT基本流程简述.md","excerpt":"<p>路由器通过使用NAT（网络地址转换）机制来区分并正确地将入站的数据包路由到内部网络中的特定设备（如设备A或设备B）。这里涉及两个关键概念：NAT表和端口号。</p>\\n<h3>NAT表</h3>\\n<p>NAT表是路由器用来跟踪内部网络设备（私有IP地址）与其对应的外部通信会话的关键数据结构。当设备A和设备B向外部世界发送数据包时，路由器会在NAT表中创建条目，记录以下信息：</p>\\n<ul>\\n<li><strong>内部源IP地址</strong>：发送数据包的设备的私有IP地址。</li>\\n<li><strong>内部源端口</strong>：发送数据包使用的端口号。</li>\\n<li><strong>外部源IP地址</strong>：路由器的公共IP地址（NAT转换后的地址）。</li>\\n<li><strong>外部源端口</strong>：路由器分配给该会话的唯一端口号，用于区分不同的通信会话。</li>\\n</ul>\\n<h3>端口号的作用</h3>\\n<p>当路由器将内部IP地址转换为公共IP地址时，它会为每个会话分配一个唯一的外部端口号。这样，当从外部网络返回的数据包到达路由器时，路由器会查看该数据包的目标端口号，并通过NAT表中的映射来确定这个数据包应该被发送到内部网络中的哪个设备。</p>\\n<h3>数据包路由的例子</h3>\\n<p>假设设备A（私有IP：192.168.1.10）和设备B（私有IP：192.168.1.11）分别与互联网上的服务器建立了通信会话。设备A可能使用端口12345与外部世界通信，而设备B使用端口54321。当这些设备通过路由器发送数据包时，路由器将使用其公共IP地址（假设为198.51.100.1），但为每个会话分配不同的外部端口号（例如，设备A的会话可能使用端口10000，设备B的会话使用端口20000）。</p>\\n<ul>\\n<li><strong>入站数据包到设备A</strong>：当服务器回复设备A的请求，发送数据包到198.51.100.1:10000时，路由器检查NAT表，发现这个端口号与设备A的通信会话匹配，然后将数据包的目标IP和端口转换为192.168.1.10:12345，并转发给设备A。</li>\\n<li><strong>入站数据包到设备B</strong>：类似地，如果服务器发送数据包到198.51.100.1:20000作为回复给设备B，路由器同样查看NAT表，识别这个端口号与设备B的通信会话匹配，随后将数据包的目标IP和端口转换为192.168.1.11:54321，并转发给设备B。</li>\\n</ul>\\n"}');export{p as comp,c as data};
